#!/usr/bin/env python
# https://github.com/csakatoku/uamobile/blob/master/uamobile/__init__.py
import re

DOCOMO_RE   = re.compile(r'^DoCoMo/\d\.\d[ /]')
SOFTBANK_RE = re.compile(r'^(?:(?:SoftBank|Vodafone|J-PHONE)/\d\.\d|MOT-)')
EZWEB_RE    = re.compile(r'^(?:KDDI-[A-Z]+\d+[A-Z]? )?UP\.Browser\/')
WILLCOM_RE  = re.compile(r'^Mozilla/3\.0\((?:DDIPOCKET|WILLCOM);|^Mozilla/4\.0 \(compatible; MSIE (?:6\.0|4\.01); Windows CE; SHARP/WS\d+SH; PPC; \d+x\d+\)')

# http://googlewebmastercentral-ja.blogspot.com/2011/12/googlebot-mobile.html
# Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)
# SAMSUNG-SGH-E250/1.0 Profile/MIDP-2.0 Configuration/CLDC-1.1 UP.Browser/6.2.3.3.c.1.101 (GUI) MMP/2.0 (compatible; Googlebot-Mobile/2.1; +http://www.google.com/bot.html)
# DoCoMo/2.0 N905i(c100;TB;W24H16) (compatible; Googlebot-Mobile/2.1; +http://www.google.com/bot.html)
# Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_1 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8B117 Safari/6531.22.7 (compatible; Googlebot-Mobile/2.1; +http://www.google.com/bot.html)
GOOGLEBOT_S_RE = re.compile(r'.*(iPhone|Android).*Googlebot-Mobile.*')
GOOGLEBOT_RE = re.compile(r'.*Googlebot-Mobile.*')

FEATURE_PHONE = ("docomo", "ezweb", "softbank", "willcom", "googlebot-featurephone")

def detect_fast(useragent):
    """
    return name of Japanese mobile carriers from a given useragent string.
    if the agent isn't mobile one, then returns 'nonmobile'.
    """
    if DOCOMO_RE.match(useragent):
        return "docomo"
    elif EZWEB_RE.match(useragent):
        return "ezweb"
    elif SOFTBANK_RE.match(useragent):
        return "softbank"
    elif WILLCOM_RE.match(useragent):
        return "willcom"
    elif GOOGLEBOT_S_RE.match(useragent):
        return "googlebot-smartphone"
    elif GOOGLEBOT_RE.match(useragent):
        return "googlebot-featurephone"
    else:
        return "nonmobile"

def is_featurephone(useragent):
    return detect_fast(useragent) in FEATURE_PHONE
